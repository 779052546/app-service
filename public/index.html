<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="/javascripts/angular.min.js"></script>
    <script src="/javascripts/angular-route.min.js"></script>
</head>
<body ng-app="myApp">
    <ul>
        <li><a href="#!/">查看商品</a></li>
        <li><a href="#!/add">添加商品</a></li>
        <li><a href="#!/orders">查看订单</a></li>
        <li><a href="#!/user">查看用户</a></li>
    </ul>
    <br>
    <hr>
    <div ng-view>

    </div>

    <script>
        var app = angular.module('myApp',['ngRoute']);
        app.config(function($routeProvider){
            $routeProvider
                .when('/',{
                     templateUrl:'./views/views.html',
                     controller:'viewsCtrl'
                 }).when('/add',{
                     templateUrl:'./add/add.html',
                     controller:'addCtrl'
                 }).when('/orders',{
                     templateUrl:'./orders/orders.html',
                     controller:'ordersCtrl'
                 }).when('/user',{
                     templateUrl:'./user/user.html',
                     controller:'userCtrl'
            })
        })
        app.controller('viewsCtrl',['$scope',function($scope){

        }])

        app.controller('addCtrl',['$scope','$http',function($scope,$http){
            $scope.arr = [];
            $scope.add = function(p){
                $scope.arr.push(p);
            }
        }])

        app.controller('ordersCtrl',['$scope','$http',function($scope,$http){
            $http.get('http://localhost:3000/orders').then(function(res){
                $scope.orders = res.data;
            },function(err){

            });
        }])

        app.controller('userCtrl',['$scope','$http',function($scope,$http){
           $scope.all = 300000;
           $scope.online =50000;

           $scope.isShow = false;

           $http.get('/users').then(function(res){
               //console.log(res.data.data);
               $scope.users = res.data.data;
           },
           function(err) {
            alert('获取失败');
           });

           var arr = [];
           $scope.showDetail = function(ua){
               arr = ua;
               console.log(ua);
               $scope.u = ua;
               $scope.isShow = true;
               $scope.isUpdate = true;
           };

           $scope.onSubmit = function(){
//                  console.log($scope.u);
                   $http.put('/users',$scope.u)
                       .then(function (res) {
                           var result = res.data;
                           if(result.success){
                            $scope.isShow = false;
                            alert('更新成功');
                           }else{
                            alert('更新失败');
                           }
                       })
           };

           // 取消操作
            $scope.back = function (u) {
                $scope.u = arr;
                $scope.isShow = false;
            };
           //删除操作
           $scope.remove = function(u){
               $http.delete('/users/'+u.id)
                   .then(function(res){
                       var result = res.data;
                       if(result.success){
                           var i = $scope.users.indexOf(u);
                           $scope.users.splice(i,1);
                       }
                   })
           };
        }])
    </script>
</body>
</html>